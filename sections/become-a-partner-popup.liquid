{%- assign form_id = section.id | append: '-contact' -%}

<style>
  /* Popup overlay */
  .partner-form-popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 100;
  }

  /* Popup content */
  #become-partner-contact-form .partner-form-popup-content::-webkit-scrollbar-thumb,
  #become-partner-contact-form .partner-form-popup-content::-webkit-scrollbar-track {
    border-radius: 100px;
  }
  #become-partner-contact-form .partner-form-popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 900px;
    height: 100%;
    max-height: 700px; /* Adjust this to make it shorter/taller */
    border-radius: 15px;
    transition: transform 0.3s ease;
    display: block;
    overflow-y: auto; /* Ensures vertical scrolling works */
  }
  .Popup_Contact_form .form-title {
    margin-top: 40px;
  }

  #become-partner-contact-form .partner-form-popup-content .social-handles-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    column-gap: 40px;
    row-gap: 15px;
    margin-top: 20px;
  }
  .partner-form-popup-close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 30px;
    cursor: pointer;
    z-index: 10;
  }

  .become-partner-form-popup-info {
    padding: 20px 50px;
    width: 100%;
    margin: 20px 20px;
  }
  .become-partner-form-popup-info h2 {
    font-family: Poppins;
    font-size: 32px;
    font-weight: 600;
    line-height: 42px;
    text-align: center;
    color: #000;
    margin-bottom: 20px;
  }

  /* Status Message Styling */
  #partnerFormStatus {
    margin-top: 15px;
    text-align: center;
    font-weight: 600;
    display: none;
  }
  .status-success {
    color: green;
  }
  .status-error {
    color: red;
  }

  /* Responsive Styles */
  @media only screen and (max-width: 1024px) {
    #become-partner-contact-form .col-span-2 {
      grid-column: auto;
      column-gap: 20px;
    }
    #become-partner-contact-form .form__grid {
      column-gap: 20px;
    }
    #become-partner-contact-form .partner-form-popup-content .social-handles-wrapper {
      column-gap: 20px;
    }
  }
  @media only screen and (max-width: 768px) {
    #become-partner-contact-form .partner-form-popup-content {
      max-height: 600px;
      max-width: 92%;
    }
    .become-partner-form-popup-info {
      padding: 20px;
    }
    .become-partner-form-popup-info h2 {
      font-size: 28px;
      line-height: 36px;
    }
    #become-partner-contact-form .partner-form-popup-content .social-handles-wrapper {
      grid-template-columns: 1fr;
    }
  }
  @media only screen and (max-width: 600px) {
    .become-partner-form-popup-info h2 {
      font-size: 24px;
      line-height: 32px;
    }
    .become-partner-form-popup-info {
      padding: 30px;
      margin: 0;
      height: 100%;
      border-radius: 10px;
    }
    #become-partner-contact-form .partner-form-popup-content {
      border-radius: 10px;
    }
    #become-partner-contact-form .social_handle {
      grid-column: span 2;
    }
    .Popup_Contact_form .form-title {
      margin-top: 20px;
    }
    #become-partner-contact-form .submit-btn {
      margin-top: 20px;
    }
    #become-partner-contact-form .form__grid {
      grid-template-columns: 1fr;
      row-gap: 15px;
    }
    #become-partner-contact-form button {
      font-size: 14px;
      line-height: 21.5px;
    }
  }

  #become-partner-contact-form span.label::after {
    content: '*';
    color: red;
  }
  #become-partner-contact-form span.label {
    font-size: 14px;
    color: #000;
  }
  #become-partner-contact-form input,
  #become-partner-contact-form textarea {
    border-radius: 0.5rem;
  }
  #become-partner-contact-form .social_handle input {
    padding-left: 50px;
  }
  #become-partner-contact-form .social-icon svg {
    display: block;
    margin-right: 10px;
    width: 18px;
  }
  #become-partner-contact-form .social-handles-wrapper span.label-span {
    font-size: 15px;
    line-height: 20px;
    margin-bottom: 5px;
  }
  #become-partner-contact-form .social_handel_notes {
    margin: -14px 0 10px;
  }
  .social-icon {
    transform: translateY(calc(-50% - 3px));
    left: 10px;
  }

  #become-partner-contact-form button {
    background: #222120 !important;
    width: 100%;
    padding: 15px 20px;
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 100px;
    font-family: Poppins, sans-serif !important;
    color: #fff;
    font-size: 21px;
    font-weight: 500;
    line-height: 31.5px;
    border: 1px solid #222120;
    cursor: pointer;
  }
  #become-partner-contact-form button:hover {
    color: #000;
    background: white !important;
  }
  #become-partner-contact-form button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  #become-partner-contact-form .social-main-label,
  #become-partner-contact-form .social_handel_notes {
    grid-column: span 2;
  }
</style>

<div id="become-partner-contact-form" class="partner-form-popup-overlay" style="display:none">
  <div class="partner-form-popup-content">
    <span id="become-partner-contact-form-close" class="close partner-form-popup-close">&times;</span>
    <div class="become-partner-form-popup-info">
      <div class="Popup_Contact_form">
        <div class="form-title">
          <h2>{{ section.settings.heading }}</h2>
        </div>

        <!-- Form Start -->
        <form id="partnerFormSubmission" class="reading-width">
          <!-- HONEYPOT (Hidden) -->
          <div style="display:none; visibility:hidden;">
            <input type="text" id="bot_check" name="bot_check" autocomplete="off">
          </div>

          <div class="form__grid grid grid-cols-2 gap-x-theme gap-y-6">
            <!-- HARDCODED EMAIL FIELD (Always Visible) -->
            <div class="col-span-2 is-required">
              <label class="label" for="email">{{ 'contact.form.email' | t }}</label>
              <input
                type="email"
                class="input w-full"
                id="email"
                name="Email"
                placeholder="i.e. johndoe@email.com"
                required
              >
            </div>

            {%- for block in section.blocks -%}
              <div
                class="col-span-2{% if block.settings.half_width %} md:col-span-1{% endif %}{% if block.settings.required %} is-required{% endif %}"
                {{ block.shopify_attributes }}
              >
                {%- case block.type -%}
                  {%- when 'first-name' -%}
                    <label class="label" for="first-name">Your Name</label>
                    <input
                      type="text"
                      class="input w-full"
                      id="first-name"
                      name="First Name"
                      placeholder="{{ 'contact.form.first-name' | t }}"
                      {% if block.settings.required %}
                        required
                      {% endif %}
                    >

                  {%- when 'last-name' -%}
                    <!-- Added Label for Alignment -->
                    <label class="label" for="last-name">Last Name</label>
                    <input
                      type="text"
                      class="input w-full"
                      id="last-name"
                      name="Last Name"
                      placeholder="{{ 'contact.form.last-name' | t }}"
                      aria-label="Last Name"
                      {% if block.settings.required %}
                        required
                      {% endif %}
                    >

                  {%- when 'body' -%}
                    <label class="label" for="message-body">{{ 'contact.form.message' | t }}</label>
                    <textarea
                      class="input w-full"
                      id="message-body"
                      name="Message"
                      placeholder="Tell us how and why youâ€™d like to partner with us"
                      rows="6"
                      {% if block.settings.required %}
                        required
                      {% endif -%}
                    ></textarea>

                  {% when 'social_handles' %}
                    <div class="social-handles-wrapper is-required">
                      <div class="social-main-label">
                        <span class="label">{{ block.settings.social_label }}</span>
                        {% if block.settings.social_label != blank -%}
                          <span class="label-span">Fill in all that apply</span>
                        {%- endif %}
                      </div>

                      <div class="social_handle">
                        <span class="social-icon">{%- render 'icon-instagram' -%}</span>
                        <input
                          type="url"
                          class="input w-full"
                          id="instagram-link"
                          name="Instagram Link"
                          placeholder="Enter Instagram Link"
                          {% if block.settings.insta_required %}
                            required
                          {% endif %}
                        >
                      </div>

                      <div class="social_handle">
                        <span class="social-icon">{%- render 'icon-facebook' -%}</span>
                        <input
                          type="url"
                          class="input w-full"
                          id="facebook-link"
                          name="Facebook Link"
                          placeholder="Enter Facebook Link"
                          {% if block.settings.facebook_required %}
                            required
                          {% endif %}
                        >
                      </div>

                      <div class="social_handle">
                        <span class="social-icon">{%- render 'icon-tiktok' -%}</span>
                        <input
                          type="url"
                          class="input w-full"
                          id="tiktok-link"
                          name="TikTok Link"
                          placeholder="Enter TikTok Link"
                          {% if block.settings.tiktok_required %}
                            required
                          {% endif %}
                        >
                      </div>

                      <div class="social_handle">
                        <span class="social-icon">{%- render 'icon-youtube' -%}</span>
                        <input
                          type="url"
                          class="input w-full"
                          id="youtube-link"
                          name="Youtube Link"
                          placeholder="Enter Youtube Link"
                          {% if block.settings.youtube_required %}
                            required
                          {% endif %}
                        >
                      </div>

                      <div class="social_handle">
                        <span class="social-icon">{%- render 'icon-globe' -%}</span>
                        <input
                          type="url"
                          class="input w-full"
                          id="personal-site-link"
                          name="Personal website Link"
                          placeholder="Enter personal website Link"
                          {% if block.settings.personal_web_link_required %}
                            required
                          {% endif %}
                        >
                      </div>

                      <div class="social_handel_notes">
                        <span>{{ block.settings.note }}</span>
                      </div>
                    </div>
                {%- endcase -%}
              </div>
            {%- endfor -%}
          </div>

          {%- if section.blocks.size > 0 -%}
            <div class="mt-6 submit-btn">
              <button type="submit" id="partnerSubmitBtn" class="{{ section.settings.button_style }} w-full md:w-auto">
                {% if section.settings.submit_btn_label == blank -%}
                  Send it to our experts
                {%- else -%}
                  {{- section.settings.submit_btn_label -}}
                {%- endif %}
              </button>
              <div id="partnerFormStatus"></div>
            </div>
          {%- endif -%}
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- Popup Logic ---
    const partnershipPopup = document.querySelectorAll(
      'a[href="https://docs.google.com/forms/d/e/1FAIpQLScQCLU9GVZMFrrR49s_wBHvT419f_7cTrPFKyXwkAbGamwdNQ/viewform"]'
    );
    const otherpartnership = document.querySelectorAll('a[href*="/pages/partnership-program"]');
    const Partner_popup = document.getElementById('become-partner-contact-form');
    const closeBtn = document.getElementById('become-partner-contact-form-close');

    const openPopup = (e) => {
      e.preventDefault();
      Partner_popup.style.display = 'block';
    };

    partnershipPopup.forEach((el) => el.addEventListener('click', openPopup));
    otherpartnership.forEach((el) => el.addEventListener('click', openPopup));

    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        Partner_popup.style.display = 'none';
      });
    }

    // --- Form Submission Logic ---
    const form = document.getElementById('partnerFormSubmission');
    const statusDiv = document.getElementById('partnerFormStatus');
    const submitBtn = document.getElementById('partnerSubmitBtn');

    // Get URL from Section Settings
    const scriptURL = '{{ section.settings.send_link }}';

    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();

        if (!scriptURL) {
          console.error('Google Script URL is missing in Section Settings');
          return;
        }

        // Helper to safely get value
        const getVal = (id) => {
          const el = document.getElementById(id);
          return el ? el.value : '';
        };

        // Construct Payload
        const formData = {
          first_name: getVal('first-name'),
          last_name: getVal('last-name'),
          email: getVal('email'),
          message: getVal('message-body'),
          instagram: getVal('instagram-link'),
          facebook: getVal('facebook-link'),
          tiktok: getVal('tiktok-link'),
          youtube: getVal('youtube-link'),
          website: getVal('personal-site-link'),
          bot_check: getVal('bot_check'), // Honeypot
        };

        // UI Updates
        submitBtn.disabled = true;
        submitBtn.innerText = 'Sending...';
        statusDiv.style.display = 'none';

        fetch(scriptURL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify(formData),
        })
          .then(() => {
            // Success
            statusDiv.innerText = 'Application Sent Successfully!';
            statusDiv.className = 'status-success';
            statusDiv.style.display = 'block';
            form.reset();

            // Optional: Close popup after 2 seconds
            setTimeout(() => {
              Partner_popup.style.display = 'none';
              statusDiv.style.display = 'none';
            }, 3000);
          })
          .catch((error) => {
            console.error('Error:', error);
            statusDiv.innerText = 'Error sending application. Please try again.';
            statusDiv.className = 'status-error';
            statusDiv.style.display = 'block';
          })
          .finally(() => {
            submitBtn.disabled = false;
            submitBtn.innerText =
              '{% if section.settings.submit_btn_label == blank %}Send it to our experts{% else %}{{ section.settings.submit_btn_label }}{% endif %}';
          });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Become A Partner Popup",
  "tag": "section",
  "class": "cc-contact-form",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "image_picker",
      "id": "icon",
      "label": "Heading Icon"
    },
    {
      "type": "text",
      "id": "submit_btn_label",
      "label": "Submit Button Label"
    },
    {
      "type": "header",
      "content": "Form Configuration"
    },
    {
      "type": "url",
      "id": "send_link",
      "label": "Google Web App URL",
      "info": "Paste the Google Apps Script Web App URL here."
    },
    {
      "type": "text",
      "id": "subject_line",
      "label": "Subject Line (Unused)"
    }
  ],
  "blocks": [
    {
      "type": "first-name",
      "name": "First-Name",
      "limit": 1,
      "settings": [
        { "type": "checkbox", "id": "required", "label": "Required", "default": true },
        { "type": "checkbox", "id": "half_width", "label": "Half width", "default": false }
      ]
    },
    {
      "type": "last-name",
      "name": "Last-Name",
      "limit": 1,
      "settings": [
        { "type": "checkbox", "id": "required", "label": "Required", "default": true },
        { "type": "checkbox", "id": "half_width", "label": "Half width", "default": false }
      ]
    },
    {
      "type": "body",
      "name": "Message",
      "limit": 1,
      "settings": [
        { "type": "checkbox", "id": "required", "label": "Required", "default": true },
        { "type": "checkbox", "id": "half_width", "label": "Half width", "default": false }
      ]
    },
    {
      "type": "social_handles",
      "name": "Social Handles",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "social_label", "label": "Fields Label" },
        { "type": "header", "content": "Required Fields" },
        { "type": "checkbox", "id": "insta_required", "label": "Instagram Required" },
        { "type": "checkbox", "id": "facebook_required", "label": "Facebook Required" },
        { "type": "checkbox", "id": "tiktok_required", "label": "Tiktok Required" },
        { "type": "checkbox", "id": "youtube_required", "label": "Youtube Required" },
        { "type": "checkbox", "id": "personal_web_link_required", "label": "Website Required" },
        { "type": "text", "id": "note", "label": "Note" }
      ]
    }
  ],
  "presets": [{ "name": "Become A Partner Popup" }],
  "disabled_on": { "groups": ["header", "footer"] }
}
{% endschema %}
