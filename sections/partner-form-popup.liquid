{%- liquid
  assign color_scheme = section.settings.color_scheme
  assign bg_color = false
  if color_scheme == 'default'
    assign bg_color = settings.bg_color
  elsif color_scheme == '1'
    assign bg_color = settings.color_scheme_1_bg_grad | default: settings.color_scheme_1_bg
  elsif color_scheme == '2'
    assign bg_color = settings.color_scheme_2_bg_grad | default: settings.color_scheme_2_bg
  elsif color_scheme == '3'
    assign bg_color = settings.color_scheme_3_bg_grad | default: settings.color_scheme_3_bg
  endif
  if bg_color == 'rgba(0,0,0,0)' or bg_color == settings.bg_color
    assign bg_color = false
  endif
-%}

<style>
  .partner-form-popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
  }

  .partner-form-popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    width: 95%;
    max-width: 900px;
    height: auto;
    max-height: 600px; /* Set max-height to 600px */
    border-radius: 15px;
    overflow-y: auto;
    display: block;
    -webkit-overflow-scrolling: touch;
  }

  .partner-form-popup-close {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 30px;
    line-height: 1;
    cursor: pointer;
    z-index: 20;
    color: #000;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    text-align: center;
  }

  .partner-form-popup-info {
    padding: 0;
    width: 100%;
    height: 100%;
  }

  .iframe-container {
    width: 100%;
    min-height: 600px; /* Matched to popup max-height */
    position: relative;
    display: block;
  }

  @media only screen and (max-width: 768px) {
    .partner-form-popup-content {
      max-height: 80vh; /* Fallback for smaller screens */
      max-width: 95%;
    }
  }
  #affiliate-sign-up-form {
    border: 0;
    width: 100%;
    height: 100%;
    min-height: 600px;
  }
</style>

<div id="partner-contact-form" class="partner-form-popup-overlay">
  <div class="partner-form-popup-content">
    <span id="partner-contact-form-close" class="partner-form-popup-close">&times;</span>
    <div class="partner-form-popup-info">
      <div class="iframe-container">
        <iframe
          id="affiliate-sign-up-form"
          src="https://api.socialsnowball.io/register-form/17060/d0c85483-1b18-42a1-add0-a69b16c43790"
          allow="clipboard-write"
        ></iframe>
      </div>
      <script>
        (function () {
          var iframe = document.querySelector('#affiliate-sign-up-form');
          window.addEventListener('message', function (t) {
            if (t.data && t.data.height) {
              iframe.style.height = t.data.height + 'px';
            }
          });
        })();
      </script>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const affiliateLinks = document.querySelectorAll('a[href="https://af.uppromote.com/salus-saunas-9974/register"]');
    const popup = document.getElementById('partner-contact-form');
    const closeBtn = document.getElementById('partner-contact-form-close');

    if (popup && closeBtn) {
      affiliateLinks.forEach((link) => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          popup.style.display = 'block';
        });
      });

      closeBtn.addEventListener('click', () => {
        popup.style.display = 'none';
      });

      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          popup.style.display = 'none';
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Partner Form",
  "tag": "section",
  "class": "cc-contact-form",
  "settings": [
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "options": [
        {
          "value": "none",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "Scheme 1"
        },
        {
          "value": "2",
          "label": "Scheme 2"
        },
        {
          "value": "3",
          "label": "Scheme 3"
        }
      ],
      "default": "none"
    }
  ],
  "presets": [
    {
      "name": "Partner Form"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
