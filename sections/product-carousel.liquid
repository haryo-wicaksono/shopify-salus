<style>
  .product-page-card__reviews .product-page-card__star-rating svg {
    width: 15px;
    height: 15px;
  }
  .product-ext-tags + .product-info__block.product-info__block--sm.product-price.product-card__price {
    margin-top: 0px;
  }

  .product-page-card__reviews {
    display: flex;
    flex-direction: row;
    align-items: center;
    flex-wrap: nowrap; /* Prevent wrapping */
  }

  .product-page-card__reviews .product-page-card__star-rating {
    display: flex; /* Ensure stars stay inline */
    flex-shrink: 0; /* Don't let stars compress */
  }

  .product-page-card__reviews .product-page-card__reviews-text {
    margin-bottom: 0;
    margin-left: 5px;
    margin-top: 3px;
    font-size: 13px;
    font-weight: 400;
    white-space: nowrap; /* Prevent text from wrapping */
    flex-shrink: 0; /* Don't compress the text */
  }

  /* Tags - Fluid Full Width (35:65 Split) */
  .product-ext-tags {
    display: flex !important;
    flex-flow: row nowrap !important;
    align-items: center;
    gap: 6px;
    margin: 10px 0;
    width: max-content;
    box-sizing: border-box;
  }

  .product-ext-tags .free-shipping-tag {
    {% comment %} flex: 1 1 43%; {% endcomment %}
    {% comment %} max-width: calc(43% - 3px); {% endcomment %}
    display: block;
    align-items: center;
    justify-content: center;
    padding: 6px 8px;
    font-size: 13px;
    font-weight: 400;
    color: #1a1a1a;
    background-color: transparent;
    border-radius: 9999px;
    white-space: nowrap;
    box-sizing: border-box;
  }

  .product-ext-tags .pd-delivery {
    {% comment %} flex: 1 1 57%; {% endcomment %}
    {% comment %} max-width: calc(57% - 3px); {% endcomment %}
    display: block;
    align-items: center;
    justify-content: center;
    padding: 6px 8px;
    font-size: 13px;
    font-weight: 400;
    color: #1a1a1a;
    background-color: transparent;
    border-radius: 9999px;
    white-space: nowrap;
    box-sizing: border-box;
  }

  /* Price Row */
  .product-carousel-price {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: center;
    gap: 8px;
  }

  .product-carousel-price__current {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
  }

  .product-carousel-price__discount {
    display: inline-flex;
    align-items: center;
    padding: 2px 4px;
    line-height: 20px;
    font-size: 16px;
    font-weight: 600;
    border: 1px solid #208b81;
    background-color: #208b81;
    color: #fff;
    border-radius: 4px;
    white-space: nowrap;
  }

  .product-carousel-price__compare {
    font-size: 18px;
    font-weight: 400;
    color: #6b7280;
    text-decoration: line-through;
  }

  .slider__item {
    border: 1px solid #000000 !important;
  }

  @media screen and (max-width: 768px) {
    .product-info .product-title {
      font-weight: 600;
      font-size: 14px;
      line-height: 18px;
    }
    .product-carousel-price__current, .product-carousel-price__compare{
      font-size: 14px;
    }
    .product-carousel-price__discount {
      font-size: 12px;
      line-height: 18px;
    }

    .product-ext-tags .pd-delivery,
    .product-ext-tags .free-shipping-tag {
      padding: 10px 8px;
      font-size: 12px;
      line-height: 10px;
    }

    .learn-more-btn {
        {% comment %} display: inline-block;
        width: 100%; {% endcomment %}
        font-weight: 500;
        font-size: 14px !important;
        padding: 10px !important;
        {% comment %} background-color: #222120;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
        margin-top: 20px; {% endcomment %}
    }
  }
</style>

<div class="carousel-background-wrapper">
  <div class="carousel-section mx-auto">
    {%- if section.settings.affirm_product != blank -%}
      {%- assign affirm_product = all_products[section.settings.affirm_product] -%}
      {% render 'affirm-messaging', product: affirm_product %}
    {%- endif -%}
    <div class="carousel-header">
      <div class="header-left">
        <h2>{{ section.settings.title }}</h2>
      </div>
      <div class="header-right">
        {%- assign button_collection = section.settings.button_collection -%}
        {%- if button_collection != blank and section.settings['button-label'] != blank -%}
          <a href="{{ button_collection.url }}" class="explore-all-btn cta-btn">
            {{ section.settings['button-label'] }}
            {% render 'icon-arrow-right-cta' %}
          </a>
        {%- else -%}
          <a href="{{ routes.collections_url }}" class="explore-all-btn cta-btn">
            Explore All Saunas {% render 'icon-arrow-right-cta' %}
          </a>
        {%- endif -%}
      </div>
    </div>
    <div class="carousel-container">
      <div class="carousel-track">
        {% # This variable holds the collection for the PRODUCTS to display. # %}
        {%- assign products_to_display_collection = section.settings.products_to_display_collection -%}

        {% # Loop through the products from the DISPLAY collection. # %}
        {%- for product in products_to_display_collection.products -%}
          <div class="product-card">
            <div class="product-image-wrapper">
              <a href="{{ product.url }}">
                <img
                  src="{{ product.featured_image | image_url: width: 400 }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  width="400"
                  height="{{ 400 | divided_by: product.featured_image.aspect_ratio | round }}"
                  loading="lazy"
                >
              </a>

              {%- if product.tags contains 'New Release' -%}
                <span class="badge release-badge">✦ New Release</span>
              {%- endif -%}
            </div>
            <div class="product-info">
              {% comment %}
                <div class="shipping-tag">
                  {% if product.metafields.custom.product_tag_free_shipping != blank %}
                    <div class="card-shipping-tag">
                      <span
                        ><img src="{{ 'shipping-icon.svg' | asset_url }}" alt="shipping icon indicator">
                        {{- product.metafields.custom.product_tag_free_shipping -}}
                      </span>
                    </div>
                  {% endif %}
                </div>
              {% endcomment %}
              {% comment %} {%- assign rating_metafield = product.metafields.reviews.rating.value -%} {% endcomment %}
              {% comment %} {%- assign rating_value_as_number = rating_metafield.rating | plus: 0 -%} {% endcomment %}
              {% comment %}
                {%- if rating_metafield and rating_value_as_number > 0 -%}
                    <div class="star-rating">
                      <span class="stars" style="--rating: {{ rating_metafield.rating | default: 0 }};"></span>
                      <span>({{ product.metafields.reviews.rating_count }})</span>
                      </div>
                  {%- endif -%}
              {% endcomment %}
              {% comment %}
                {%- if settings.card_show_rating -%}
                  <div class="product_ratings">
                    <div class="jdgm-widget jdgm-preview-badge">
                      <span class="rating-counter">{{ product.metafields.reviews.rating.value }}</span>
                      {{ product.metafields.judgeme.badge }}
                      </div>
                  </div>
                {% endif %}
              {% endcomment %}
              <a href="{{ product.url }}" class="product-title">{{ product.title }}</a>

              {% comment %}
                <div class="product-page-card__reviews">
                  <span class="product-page-card__star-rating">
                    {% render 'icon-star' %}
                    {% render 'icon-star' %}
                    {% render 'icon-star' %}
                    {% render 'icon-star' %}
                    {% render 'icon-star' %}
                  </span>
                  <p class="product-page-card__reviews-text">Rated 5-stars by hundreds</p>
                </div>
              {% endcomment %}

              <div class="product-ext-tags">
                <span class="free-shipping-tag">Free Shipping</span>
                <span class="pd-delivery">{{ product.metafields.custom.delivery | append: ' Delivery' }}</span>
              </div>

              <div class="product-carousel-price">
                <span class="product-carousel-price__current">{{ product.price | money_without_trailing_zeros }}</span>
                {%- if product.compare_at_price > product.price -%}
                  {%- assign discount_amount = product.compare_at_price | minus: product.price -%}
                  <span class="product-carousel-price__discount">${{ discount_amount | divided_by: 100 }} off</span>
                  <span class="product-carousel-price__compare">
                    {{- product.compare_at_price | money_without_trailing_zeros -}}
                  </span>
                {%- endif -%}
              </div>

              {% comment %}
                {%- if settings.card_price_bottom == false -%}
                  {%- render 'price', product: product, class: 'price--top' -%}
                {%- endif -%}
              {% endcomment %}
              {% comment %}
                <div class="price">
                  <span class="current-price">{{ product.price | money }}</span>
                  {%- if product.compare_at_price > product.price -%}
                    <span class="compare-at-price">{{ product.compare_at_price | money }}</span>
                  {%- endif -%}
                </div>
              {% endcomment %}
              <a href="{{ product.url }}" class="learn-more-btn">Learn More</a>
            </div>
          </div>
        {%- else -%}
          <div class="product-card--empty">
            <p>No products found. Please select a collection in the theme editor settings for this section.</p>
          </div>
        {%- endfor -%}
      </div>
      <button class="carousel-arrow arrow-left">❮</button>
      <button class="carousel-arrow arrow-right">❯</button>
    </div>
  </div>
</div>

{% comment %}
  Shopify will automatically load these files on any page where this section is used.
  This is more efficient than loading them on every page in theme.liquid.
{% endcomment %}
{{ 'product-carousel.css' | asset_url | stylesheet_tag }}
<script src="{{ 'product-carousel.js' | asset_url }}" defer="defer"></script>

{% comment %}
  This is the schema. It defines the settings that appear in the
  Shopify Theme Customizer for this specific section.
{% endcomment %}
{% schema %}
{
  "name": "Product Carousel",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Explore our best-in-class infrared saunas"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button-label",
      "label": "Button Label",
      "default": "Explore All Saunas"
    },
    {
      "type": "collection",
      "id": "button_collection",
      "label": "Collection for Button Link",
      "info": "The 'Explore All' button will link to this main collection."
    },
    {
      "type": "header",
      "content": "Products to Display"
    },
    {
      "type": "product",
      "id": "affirm_product",
      "label": "Affirm Product (optional)",
      "info": "Select a product to use for Affirm promotional messaging above the heading."
    },
    {
      "type": "collection",
      "id": "products_to_display_collection",
      "label": "Collection to Display Products From",
      "info": "Create a manual collection with 7 products to show in the carousel."
    }
  ],
  "presets": [
    {
      "name": "Product Carousel"
    }
  ]
}
{% endschema %}
